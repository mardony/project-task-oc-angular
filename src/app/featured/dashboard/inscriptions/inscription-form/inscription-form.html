<div class="form-container">
  <div class="form-header">
    <h2>Nueva Inscripción</h2>
    <p>Selecciona un alumno y un curso</p>
  </div>

  <form [formGroup]="inscriptionForm" (ngSubmit)="onSubmit()">

    <!-- ALUMNO -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Alumno</mat-label>
      <mat-select formControlName="studentId">
        @if (students$ | async; as students) {
          @for (student of students; track student.id) {
            <mat-option [value]="student.id">
              {{ student.name }} — {{ student.email }}
            </mat-option>
          }
        }
      </mat-select>
      <mat-error *ngIf="hasError('studentId','required')">
        Selecciona un alumno
      </mat-error>
    </mat-form-field>

    <!-- CURSO -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Curso</mat-label>
      <mat-select formControlName="courseId">
        @if (courses$ | async; as courses) {
          @for (course of getActiveCourses(courses); track course.id) {
            <mat-option [value]="course.id">
              {{ course.title }} • {{ course.description.substring(0,50) }}...
            </mat-option>
          }
        }
      </mat-select>
      <mat-error *ngIf="hasError('courseId','required')">
        Selecciona un curso
      </mat-error>
    </mat-form-field>

    <!-- INFO -->
    <mat-card>
      <mat-card-content>
        <p><strong>Alumno:</strong> {{ selectedStudentName$ | async }}</p>
        <p><strong>Curso:</strong> {{ selectedCourseTitle$ | async }}</p>
        <p><strong>Fecha:</strong> {{ currentDate | date:'fullDate' }}</p>
        <p><strong>Registrado por:</strong> {{ currentUser?.username || 'Usuario' }}</p>
      </mat-card-content>
    </mat-card>

    <!-- ACCIONES -->
    <div class="form-actions">
      <button mat-button type="button" (click)="onCancel()">Cancelar</button>
      <button mat-flat-button color="primary" type="submit"
              [disabled]="inscriptionForm.invalid || isLoading">
        Crear Inscripción
      </button>
    </div>

  </form>
</div>
